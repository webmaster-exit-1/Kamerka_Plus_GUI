<!DOCTYPE html>
<html lang="en">
{% load static %}
{% block page_content %}
    <head>
        <!-- META SECTION -->
        <title>Results - ꓘamerka</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- END META SECTION -->

        <!-- CSS INCLUDE -->
        <script src="{% static 'js/d3.js' %}"></script>
        <script src="{% static 'js/d3.layout.cloud.js' %}" charset="UTF-8"></script>
        <script src="{% static 'js/d3.wordcloud.js' %}" charset="UTF-8"></script>
        <link rel="stylesheet" type="text/css" id="theme" href="{% static 'css/theme-default.css' %}"/>
        <link rel="stylesheet" type="text/css" href="{% static 'css/leaflet.css' %}"/>
        <!-- EOF CSS INCLUDE -->
    </head>
    <body>
        <!-- START PAGE CONTAINER -->
        <div class="page-container">

            <!-- START PAGE SIDEBAR -->
            <div class="page-sidebar">
                <!-- START X-NAVIGATION -->
                <ul class="x-navigation">
                    <li class="xn-logo">
                        <a href="/">ꓘamerka</a>
                        <a href="#" class="x-navigation-control"></a>
                    </li>
                    <li class="xn-profile">

                        <div class="profile">
                            <div class="profile-image">
                            </div>
                            <div class="profile-data">
                                  <img width=200px height=200px src="{% static 'images/OffensiveOsint-logo-RGB-2.svg' %}">

                            </div>

                        </div>
                    </li>
                    <li class="xn-title">Navigation</li>
                    <li class="">
                        <a href="/index"><span class="fa fa-desktop"></span> <span class="xn-text">Dashboard</span></a>
                    </li>
                    <li class="">
                        <a href="/history"><span class="fa fa-files-o"></span> <span class="xn-text">History</span></a>
                    </li>
                    <li class="">
                        <a href="/map"><span class="fa fa-map-marker"></span> <span class="xn-text">Map</span></a>
                    </li>
                    <li class="">
                        <a href="/devices"><span class="fa fa-search"></span> <span class="xn-text">Search</span></a>
                    </li>

                                       <li class="">
                        <a href="/gallery"><span class="fa fa-camera"></span> <span class="xn-text">Gallery</span></a>
                    </li>

                    <li class="xn-title">Components</li>

                    <li>
                        <a href="/sources"><span class="fa fa-book"></span> <span class="xn-text">Useful links</span></a>
                    </li>


                </ul>
                <!-- END X-NAVIGATION -->
            </div>
            <!-- END PAGE SIDEBAR -->

            <!-- PAGE CONTENT -->
            <div class="page-content" style="height: 100%">

                <!-- START X-NAVIGATION VERTICAL -->
                <ul class="x-navigation x-navigation-horizontal x-navigation-panel">
                    <!-- TOGGLE NAVIGATION -->

                    <!-- END TOGGLE NAVIGATION -->
                    <!-- SEARCH -->

                    <!-- END SEARCH -->
                    <!-- SIGN OUT -->

                    <!-- END SIGN OUT -->
                    <!-- MESSAGES -->

                    <!-- END MESSAGES -->
                    <!-- TASKS -->

                    <!-- END TASKS -->
                </ul>
                <!-- START BREADCRUMB -->
<ul class="breadcrumb">
    {% if task_id %}
    <div class='progress-wrapper'>
        <div id='progress-bar' class='progress-bar' style="background-color: #0064d7; width: 0%;">&nbsp;</div>
    </div>
    <div id="progress-bar-message" style="color:#ff00cd">Scan in progress...</div>
    {% endif %}
</ul>
<!-- END BREADCRUMB -->

                <!-- PAGE CONTENT WRAPPER -->

                <!-- PAGE CONTENT WRAPPER -->
                <div class="page-content-wrap">

                    <!-- START WIDGETS -->
                 <div class="row">
                        <div class="col-md-12">
                            <div class="panel panel-default tabs">
                                <ul class="nav nav-tabs nav-justified">
                                    <li class="active"><a href="#tab8" data-toggle="tab">Map</a></li>
                                    <li><a href="#tab9" data-toggle="tab">Devices</a></li>
                                    <li><a href="#tab10" data-toggle="tab">Statistics</a></li>
                                </ul>
                                <div class="panel-body tab-content">
                                    <div class="tab-pane active" id="tab8">
 <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">World Map</h3>
                                </div>
                                <div class="panel-body panel-body-map">
                                    <div id="leaflet_world_map" style="width: 100%; height: 700px;"></div>


                                </div>
                                    </div>
                                    </div>


                                    <div class="tab-pane" id="tab9">
              <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Devices</h3>


                                </div>
                                <div class="panel-body">
                                        <table id="customers2" class="table datatable">
                                            <thead>
                                            <tr>
                                                    <th>IP</th>
                                                    <th>Type</th>
                                                    <th>{% if device.nmap %} Ports {% else %} Product {% endif %}</th>
                                                    <th>Port</th>
                                                    <th>City</th>
                                                    <th>Latitude</th>
                                                    <th>Longitude</th>
                                                    <th>CVE</th>
                                                    <th>Indicator</th>
                                                <th>Located</th>
                                                    <th>Exploited</th>


                                                </tr>
                                            </thead>
                                            <tbody style="color: #0064d7;">

                                                {% for device in search %}
                                                {% if device.located or device.exploited_scanned %}
                                                <tr style="background:#ff00cd">
                                                    {% else %}
                                                    <tr>
                                                {% endif %}

                                                    <td>                                     <a href="{% url 'device' id=device.search_id ip=device.ip device_id=device.id %}">
                                                        {{ device.ip }}</a></td>
                                                    <td>{{ device.type }}</td>
                                                    <td>{%if device.type == "NMAP" %} {{device.port}} {% else %} {{ device.product }}{% endif %}</td>
                                                    <td>{{ device.port }}</td>
                                                    <td>{{ device.city }}</td>
                                                    <td>{{ device.lat }}</td>
                                                    <td>{{ device.lon }}</td>
                                                    <td>{{ device.vulns|slice:"1:-1" }}</td>
                                                    <td>{% for a in device.indicator %}{{ a }} {% endfor %}</td>
                                                    <td>{{ device.located }}</td>
                                                   <td>{{ device.exploited_scanned }}</td>




                                                </tr>


                                            {% endfor %}

                                            </tbody>
                                        </table>
</div>




                                </div>
                                    </div>

                                    <div class="tab-pane" id="tab10">

                                    <!-- START DONUT CHART -->


                <!-- END PAGE TITLE -->

                <!-- PAGE CONTENT WRAPPER -->
                <div class="page-content-wrap">

                                                <div class="col-md-6">

                            <!-- START DONUT CHART -->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Ports</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="morris-horizontal" style="height: 300px;"></div>
                                </div>
                            </div>
                            <!-- END DONUT CHART -->

                        </div>
                                            <div class="col-md-6">

                            <!-- START DONUT CHART -->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Vulnerabilities</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="wordcloud" style="height: 300px;"></div>
                                </div>
                            </div>
                            <!-- END DONUT CHART -->

                        </div>


                    <div class="row">
                        <div class="col-md-6">

                            <!-- START BAR CHART -->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Cities</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="morris-bar-example" style="height: 300px; "></div>
                                </div>
                            </div>
                            <!-- END BAR CHART -->

                        </div>
                        <div class="col-md-6">

                            <!-- START DONUT CHART -->
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h3 class="panel-title">Devices</h3>
                                </div>
                                <div class="panel-body">
                                    <div id="morris-donut-example" style="height: 300px;"></div>
                                </div>
                            </div>
                            <!-- END DONUT CHART -->

                        </div>
                    </div>

                </div>
                <!-- END PAGE CONTENT WRAPPER -->
            </div>
            <!-- END PAGE CONTENT -->
        </div>
        <!-- END PAGE CONTAINER -->

                                </div>
                            </div>

                            <!-- START DATATABLE EXPORT -->

                            </div>
                <!-- END PAGE CONTENT WRAPPER -->
            </div>
            <!-- END PAGE CONTENT -->
        </div>
        <!-- END PAGE CONTAINER -->

        <!-- MESSAGE BOX-->

        </div>



        <!-- END MESSAGE BOX--><script src="{% static 'js/leaflet.js' %}"></script>

<script type="text/javascript">
function initialize() {
    var centerLat = 0, centerLon = 0;
    {% for device in search %}
    {% if forloop.first and device.lat and device.lon %}
    centerLat = {{ device.lat }};
    centerLon = {{ device.lon }};
    {% endif %}
    {% endfor %}

    var map = L.map('leaflet_world_map', {
        minZoom: 1,
        maxZoom: 17
    }).setView([centerLat, centerLon], 4);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var markers = [];
    {% for device in search %}
    {% if device.lat and device.lon %}
    (function() {
        var m = L.marker([{{device.lat}}, {{device.lon}}]).addTo(map);
        m.bindPopup('<a href="{{device.search_id}}/{{device.id}}/{{device.ip}}">{{device.type}} - {{device.ip}}</a>');
        markers.push(m);
    })();
    {% endif %}
    {% endfor %}

    if (markers.length > 1) {
        var group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
    }
}

document.addEventListener('DOMContentLoaded', function() {
    initialize();
});

</script>
        <script>

        </script>
<script src="{% static 'js/d3.wordcloud.js' %}" charset="UTF-8"></script>
                <script src="{% static 'js/d3.layout.cloud.js' %}" charset="UTF-8"></script>
<script type="text/javascript">
     d3v3.wordcloud()
        .size([500, 300])
        .selector('#wordcloud')
        .words([{% for vuln, link in vulns %} {text: "{{  vuln }}", size: "15"}, {% endfor %}])
        .start();
    </script>



        <script type="text/javascript" src="{% static 'js/plugins/jquery/jquery.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/plugins/jquery/jquery-ui.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/plugins/bootstrap/bootstrap.min.js' %}"></script>
        <!-- END PLUGINS -->

        <!-- START THIS PAGE PLUGINS-->

        <script type="text/javascript" src="{% static 'js/plugins/morris/raphael-min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/plugins/morris/morris.min.js' %}"></script>
                <script type="text/javascript" src="{% static 'js/plugins/datatables/jquery.dataTables.min.js' %}"></script>
        <script type='text/javascript' src="{% static 'js/plugins/bootstrap/bootstrap-datepicker.js' %}"></script>


        <!-- END THIS PAGE PLUGINS-->
<!--                           <script type="text/javascript" src="js/plugins/morris/raphael-min.js"></script>-->
<!--        <script type="text/javascript" src="js/plugins/morris/morris.min.js"></script>-->

        <!-- START TEMPLATE -->
        <script type="text/javascript" src="{% static 'js/plugins.js' %}"></script>

        <script type="text/javascript" src="{% static 'js/actions.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/draw_charts_results.js' %}"></script>
                <script>drawCharts({{ports|safe}}, {{city|safe}},{{category|safe}});</script>

        <!-- END TEMPLATE -->

    <!-- END SCRIPTS -->


    </body>
</html>

{% endblock %}





