<!DOCTYPE html>
<html lang="en">
{% load static %}
{% block page_content %}
    <head>
        <!-- META SECTION -->
        <title>Map - ꓘamerka</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <!-- END META SECTION -->

        <!-- CSS INCLUDE -->
        <script src="{% static 'js/d3.js' %}"></script>
        <script src="{% static 'js/d3.layout.cloud.js' %}" charset="UTF-8"></script>
        <script src="{% static 'js/d3.wordcloud.js' %}" charset="UTF-8"></script>
        <link rel="stylesheet" type="text/css" id="theme" href="{% static 'css/theme-default.css' %}"/>
        <link rel="stylesheet" type="text/css" href="{% static 'css/leaflet.css' %}"/>
        <!-- EOF CSS INCLUDE -->
    </head>
    <body>
        <!-- START PAGE CONTAINER -->
        <div class="page-container">

            <!-- START PAGE SIDEBAR -->
            <div class="page-sidebar">
                <!-- START X-NAVIGATION -->
                <ul class="x-navigation">
                    <li class="xn-logo">
                        <a href="/">ꓘamerka</a>
                        <a href="#" class="x-navigation-control"></a>
                    </li>
                    <li class="xn-profile">

                        <div class="profile">
                            <div class="profile-image">
                            </div>
                            <div class="profile-data">
                                  <img width=200px height=200px src="https://www.offensiveosint.io/content/images/2020/07/OffensiveOsint-logo-RGB-2.png">

                            </div>

                        </div>
                    </li>
                    <li class="xn-title">Navigation</li>
                    <li class="">
                        <a href="index"><span class="fa fa-desktop"></span> <span class="xn-text">Dashboard</span></a>
                    </li>
                    <li class="">
                        <a href="history"><span class="fa fa-files-o"></span> <span class="xn-text">History</span></a>
                    </li>
                    <li class="">
                        <a href="map"><span class="fa fa-map-marker"></span> <span class="xn-text">Map</span></a>
                    </li>
                    <li class="">
                        <a href="devices"><span class="fa fa-search"></span> <span class="xn-text">Search</span></a>
                    </li>

                   <li class="">
                        <a href="gallery"><span class="fa fa-camera"></span> <span class="xn-text">Gallery</span></a>
                    </li>

                    <li class="xn-title">Components</li>

                    <li>
                        <a href="sources"><span class="fa fa-book"></span> <span class="xn-text">Useful links</span></a>
                    </li>


                </ul>
                <!-- END X-NAVIGATION -->
            </div>
            <!-- END PAGE SIDEBAR -->

            <!-- PAGE CONTENT -->
            <div class="page-content">

                <!-- START X-NAVIGATION VERTICAL -->
                <ul class="x-navigation x-navigation-horizontal x-navigation-panel">

                    <!-- END TASKS -->
                </ul>
                <!-- START BREADCRUMB -->
<ul class="breadcrumb">


                </ul>
                <!-- END BREADCRUMB -->

                <!-- PAGE CONTENT WRAPPER -->
                <!-- END BREADCRUMB -->

                <!-- PAGE CONTENT WRAPPER -->
                <div class="page-content-wrap">

                    <!-- START WIDGETS -->
                    <div class="row">
                        <div class="panel-body tab-content">
                       <div class="panel panel-default">
                                <div class="panel-heading ui-draggable-handle">
                                    <h3 class="panel-title">World Map</h3>
                                </div>
                                <div class="panel-body panel-body-map">
                                    <div id="leaflet_world_map" style="width: 100%; height: 600px;">

                                    </div>
                                </div>
                       </div>
                </div>
                    </div>

                <!-- END PAGE CONTENT WRAPPER -->
            </div>
            </div>
        </div>

            <!-- END PAGE CONTENT -->
        <!-- END PAGE CONTAINER -->

    <!-- START SCRIPTS -->
        <!-- START PLUGINS -->
<script src="{% static 'js/leaflet.js' %}"></script>

<script type="text/javascript">
function initialize() {
    var centerLat = 0, centerLon = 0;
    {% for device in devices %}
    {% if forloop.first %}
    centerLat = {{ device.lat }};
    centerLon = {{ device.lon }};
    {% endif %}
    {% endfor %}

    var map = L.map('leaflet_world_map', {
        minZoom: 1,
        maxZoom: 17
    }).setView([centerLat, centerLon], 3);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var markers = [];
    {% for device in devices %}
    (function() {
        var m = L.marker([{{device.lat}}, {{device.lon}}]).addTo(map);
        m.bindPopup('<a href="/results/{{device.search_id}}/{{device.id}}/{{device.ip}}">{{device.type}} - {{device.ip}}</a>');
        markers.push(m);
    })();
    {% endfor %}

    if (markers.length > 1) {
        var group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
    }
}

document.addEventListener('DOMContentLoaded', function() {
    initialize();
});
</script>

<script src="{% static 'js/d3.wordcloud.js' %}" charset="UTF-8"></script>
                <script src="{% static 'js/d3.layout.cloud.js' %}" charset="UTF-8"></script>

                <script type="text/javascript" src="{% static 'js/plugins/jquery/jquery.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/plugins/jquery/jquery-ui.min.js' %}"></script>
        <script type="text/javascript" src="{% static 'js/plugins/bootstrap/bootstrap.min.js' %}"></script>
        <!-- END PLUGINS -->

        <!-- START THIS PAGE PLUGINS-->


        <!-- END THIS PAGE PLUGINS-->

        <!-- START TEMPLATE -->
        <script type="text/javascript" src="{% static 'js/actions.js' %}"></script>


        <!-- END TEMPLATE -->
    <!-- END SCRIPTS -->

    </body>
</html>

{% endblock %}





